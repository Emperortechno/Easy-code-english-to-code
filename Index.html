<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal AI Code Translator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@300;400;600;700&display=swap');
        
        :root {
            --primary: #f97316; /* Rust Orange */
            --bg-dark: #020617;
            --card-bg: #0f172a;
        }

        body {
            background-color: var(--bg-dark);
            color: #f8fafc;
            font-family: 'Inter', sans-serif;
        }

        .code-font { font-family: 'Fira Code', monospace; }

        .glass {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .loader {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 28px;
            height: 28px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        
        select option { background: #0f172a; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-5xl mx-auto space-y-6">
        <!-- Header -->
        <header class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
            <div>
                <h1 class="text-3xl font-extrabold bg-gradient-to-r from-orange-400 via-red-400 to-amber-400 bg-clip-text text-transparent">
                    Universal Logic-to-Code
                </h1>
                <p class="text-slate-400 text-sm">Convert English to Rust, C++, Python, and more.</p>
            </div>
            <div class="flex items-center gap-3">
                <div class="bg-slate-800 p-1 rounded-lg flex border border-slate-700">
                    <button onclick="setMode('logic')" id="modeLogic" class="px-4 py-1.5 rounded-md text-xs font-bold transition-all bg-orange-600 text-white shadow-lg">GENERATE</button>
                    <button onclick="setMode('explain')" id="modeExplain" class="px-4 py-1.5 rounded-md text-xs font-bold transition-all text-slate-400 hover:text-white">EXPLAIN</button>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <!-- Left Panel -->
            <div class="lg:col-span-5 space-y-4">
                <div class="glass p-5 rounded-2xl shadow-2xl space-y-4">
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-2">Target Language</label>
                        <select id="langSelect" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-slate-200 focus:ring-2 focus:ring-orange-500 outline-none transition-all">
                            <option value="rust">Rust (Safe & Fast)</option>
                            <option value="cpp">C++ (Modern/Performance)</option>
                            <option value="python">Python (AI/General)</option>
                            <option value="javascript">JavaScript (Web/React)</option>
                            <option value="java">Java (Enterprise)</option>
                            <option value="swift">Swift (Apple Ecology)</option>
                        </select>
                    </div>

                    <div>
                        <div class="flex justify-between mb-2">
                            <label class="text-xs font-bold text-slate-500 uppercase tracking-widest block">English Description</label>
                            <button onclick="toggleStoryContext()" id="storyBtn" class="text-[10px] px-2 py-0.5 rounded border border-slate-700 text-slate-400 hover:border-orange-500 hover:text-orange-400 transition-all">
                                <i class="fas fa-dragon mr-1"></i> Story Mode: OFF
                            </button>
                        </div>
                        <textarea 
                            id="userInput" 
                            class="w-full bg-slate-900 border border-slate-700 rounded-xl p-4 text-slate-200 focus:ring-2 focus:ring-orange-500 outline-none transition-all custom-scrollbar"
                            rows="8"
                            placeholder="e.g. 'Create a Rust struct for Techno the Dragon with fields for health and chaos level. Add a method to increase chaos safely.'"
                        ></textarea>
                    </div>

                    <button 
                        onclick="processCode()" 
                        id="actionBtn"
                        class="w-full bg-orange-600 hover:bg-orange-500 text-white font-bold py-4 rounded-xl transition-all flex items-center justify-center gap-3 shadow-lg shadow-orange-500/20"
                    >
                        <i class="fas fa-microchip"></i>
                        <span>Generate Code</span>
                    </button>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div class="glass p-3 rounded-xl text-[11px] text-slate-400">
                        <i class="fas fa-shield-alt text-orange-400 mr-1"></i> Memory Safe
                    </div>
                    <div class="glass p-3 rounded-xl text-[11px] text-slate-400">
                        <i class="fas fa-box-open text-orange-400 mr-1"></i> Cargo Ready
                    </div>
                </div>
            </div>

            <!-- Right Panel -->
            <div class="lg:col-span-7 space-y-4">
                <div id="outputCard" class="glass rounded-2xl overflow-hidden flex flex-col h-full min-h-[450px]">
                    <div class="bg-slate-800/50 px-5 py-3 border-b border-slate-700 flex items-center justify-between">
                        <span id="outputTitle" class="text-xs font-mono text-slate-400 uppercase tracking-tighter">Ready...</span>
                        <div class="flex gap-4">
                             <button onclick="copyCode()" class="text-xs text-orange-400 hover:text-orange-300 font-bold flex items-center gap-2">
                                <i id="copyIcon" class="fas fa-copy"></i>
                                <span id="copyText">COPY</span>
                            </button>
                        </div>
                    </div>
                    
                    <div id="loadingPlaceholder" class="hidden flex-1 flex flex-col items-center justify-center space-y-4 opacity-50">
                        <div class="loader"></div>
                        <p class="text-xs font-mono uppercase tracking-widest">Compiling Logic...</p>
                    </div>

                    <div id="codeWrapper" class="flex-1 overflow-auto custom-scrollbar p-6">
                        <pre id="codeOutput" class="code-font text-sm leading-relaxed text-orange-100 whitespace-pre"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="errorToast" class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-red-600 text-white px-6 py-3 rounded-full shadow-2xl hidden flex items-center gap-3 font-bold text-sm">
        <i class="fas fa-exclamation-triangle"></i>
        <span id="errorMsg">Something went wrong</span>
    </div>

    <script>
        const apiKey = ""; 
        let currentMode = 'logic';
        let storyMode = false;

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('modeLogic').className = mode === 'logic' ? 'px-4 py-1.5 rounded-md text-xs font-bold transition-all bg-orange-600 text-white' : 'px-4 py-1.5 rounded-md text-xs font-bold transition-all text-slate-400 hover:text-white';
            document.getElementById('modeExplain').className = mode === 'explain' ? 'px-4 py-1.5 rounded-md text-xs font-bold transition-all bg-orange-600 text-white' : 'px-4 py-1.5 rounded-md text-xs font-bold transition-all text-slate-400 hover:text-white';
            document.getElementById('actionBtn').innerText = mode === 'logic' ? 'Generate Code' : 'Explain Logic';
        }

        function toggleStoryContext() {
            storyMode = !storyMode;
            const btn = document.getElementById('storyBtn');
            btn.innerHTML = storyMode ? '<i class="fas fa-dragon mr-1"></i> Story Mode: ON' : '<i class="fas fa-dragon mr-1"></i> Story Mode: OFF';
            btn.classList.toggle('border-orange-500', storyMode);
            btn.classList.toggle('text-orange-400', storyMode);
        }

        async function processCode() {
            const input = document.getElementById('userInput').value.trim();
            const lang = document.getElementById('langSelect').value;
            if (!input) return;

            const btn = document.getElementById('actionBtn');
            const loader = document.getElementById('loadingPlaceholder');
            const codeWrapper = document.getElementById('codeWrapper');
            const outputTitle = document.getElementById('outputTitle');
            const codeOutput = document.getElementById('codeOutput');

            btn.disabled = true;
            btn.classList.add('opacity-50');
            loader.classList.remove('hidden');
            codeWrapper.classList.add('hidden');
            outputTitle.innerText = "Processing...";
            codeOutput.textContent = "";

            let storyContext = "";
            if (storyMode) {
                storyContext = `The user is building the 'Consortium Chronicles' universe. Characters include: Techno the Dragon, Dark Lambo (Dark Dragon), Anti-Dragons, Darth Wham bow. If the prompt mentions these, use idiomatic ${lang} patterns to represent them. For Rust, use Structs and Traits effectively.`;
            }

            const systemPrompt = `You are an expert ${lang} programmer.
            Mode: ${currentMode === 'logic' ? 'Raw Code' : 'Educational Explanation'}
            
            Strict Instructions:
            1. If mode is Logic: Return ONLY code. Include standard libraries (std in Rust, etc.) and external crates if common.
            2. If mode is Explain: Teach the user how the code works.
            3. ${storyContext}
            4. Never use markdown code blocks (\`\`\`). Return the direct text.`;

            const MODEL_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent";

            let retries = 0;
            const maxRetries = 5;

            async function fetchAI() {
                try {
                    const response = await fetch(`${MODEL_URL}?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: input }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] }
                        })
                    });

                    if (!response.ok) throw new Error('API Error');
                    const data = await response.json();
                    const result = data.candidates?.[0]?.content?.parts?.[0]?.text;

                    codeOutput.textContent = result ? result.trim() : "No result returned.";
                    outputTitle.innerText = `${lang.toUpperCase()} Output`;
                    codeWrapper.classList.remove('hidden');
                } catch (err) {
                    if (retries < maxRetries) {
                        retries++;
                        await new Promise(r => setTimeout(r, Math.pow(2, retries) * 1000));
                        return fetchAI();
                    }
                    showError("Sync failure. Try again in a moment.");
                } finally {
                    btn.disabled = false;
                    btn.classList.remove('opacity-50');
                    loader.classList.add('hidden');
                }
            }

            await fetchAI();
        }

        function copyCode() {
            const text = document.getElementById('codeOutput').textContent;
            if (!text) return;
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            const copyT = document.getElementById('copyText');
            copyT.innerText = "COPIED!";
            setTimeout(() => copyT.innerText = "COPY", 2000);
        }

        function showError(msg) {
            const toast = document.getElementById('errorToast');
            document.getElementById('errorMsg').innerText = msg;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 5000);
        }
    </script>
</body>
</html>

